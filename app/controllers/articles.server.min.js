"use strict";var mongoose=require("mongoose"),Article=mongoose.model("Article"),getErrorMessage=function(a){if(!a.errors)return"Error de servidor desconocido";for(var b in a.errors)if(a.errors[b].message)return a.errors[b].message};exports.create=function(a,b){var c=new Article(a.body);c.creador=a.user,c.save(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.list=function(a,b){Article.find().sort("-creado").populate("creador","firstName lastName fullName").exec(function(a,c){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.read=function(a,b){b.json(a.article)},exports.update=function(a,b){var c=a.article;c.titulo=a.body.titulo,c.contenido=a.body.contenido,c.save(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports["delete"]=function(a,b){var c=a.article;c.remove(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.articleByID=function(a,b,c,d){Article.findById(d).populate("creador","firstName lastName fullName").exec(function(b,e){return b?c(b):e?(a.article=e,void c()):c(new Error("Fallo al cargar el artículo "+d))})},exports.hasAuthorization=function(a,b,c){return a.article.creador.id!==a.user.id?b.status(403).send({message:"Usuario no está autorizado"}):void c()};var mongoose=require("mongoose"),Article=mongoose.model("Article"),getErrorMessage=function(a){if(!a.errors)return"Error de servidor desconocido";for(var b in a.errors)if(a.errors[b].message)return a.errors[b].message};exports.create=function(a,b){var c=new Article(a.body);c.creador=a.user,c.save(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.list=function(a,b){Article.find().sort("-creado").populate("creador","firstName lastName fullName").exec(function(a,c){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.read=function(a,b){b.json(a.article)},exports.update=function(a,b){var c=a.article;c.titulo=a.body.titulo,c.contenido=a.body.contenido,c.save(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports["delete"]=function(a,b){var c=a.article;c.remove(function(a){return a?b.status(400).send({message:getErrorMessage(a)}):void b.json(c)})},exports.articleByID=function(a,b,c,d){Article.findById(d).populate("creador","firstName lastName fullName").exec(function(b,e){return b?c(b):e?(a.article=e,void c()):c(new Error("Fallo al cargar el artículo "+d))})},exports.hasAuthorization=function(a,b,c){return a.article.creador.id!==a.user.id?b.status(403).send({message:"Usuario no está autorizado"}):void c()};