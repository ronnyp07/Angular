"use strict";var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Cierre=mongoose.model("Cierre"),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Cierre(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Pais ya existe"}):b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.cierre)},exports.update=function(a,b){var c=a.cierre;c.cierreCI=a.body.cierreCI,c.firstName=a.body.firstName,c.lastName=a.body.lastName,c.cierreEmail=a.body.cierreEmail,c.cierreTelefono=a.body.cierreTelefono,c.cierreDireccion=a.body.cierreDireccion,c.pais=a.body.pais,c.ciudad=a.body.ciudad,c.sector=a.body.sector,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getMaxB=function(a,b){console.log(a.body.type+" This is a test"),Cierre.find({proType:a.body.type}).sort({CierreId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports["delete"]=function(a,b){var c=a.cierre;c.remove(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.list=function(a,b){"B"===a.body.info.proType?Cierre.find({year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}).exec(function(a,c){return a?(console.log(a),b.status(400).send({message:errorHandler.getErrorMessage(a)})):void b.jsonp(c)}):"BL"===a.body.info.proType?Cierre.find({year:a.body.info.year,proType:"BL"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)}):Cierre.find({year:a.body.info.year,proType:"P"}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.updateCierre=function(a,b){var c="",d=a.body.info.proType;c="B"===d?{year:a.body.info.year,month:a.body.info.month,proType:a.body.info.proType}:"BL"===d?{year:a.body.info.year,proType:a.body.info.proType}:{year:a.body.info.year,proType:a.body.info.proType},Cierre.findOne(c,function(d,e){if(d)throw d;if(e){var f=parseInt(a.body.info.newCount),g={$set:{counter:f}};Cierre.update(c,g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})}})},exports.cierreByID=function(a,b,c,d){Cierre.findById(d).populate("user","displayName").exec(function(b,e){return b?c(b):e?(a.cierre=e,void c()):c(new Error("Failed to load cierre "+d))})},exports.hasAuthorization=function(a,b,c){return a.cierre.user.id!==a.user.id?b.status(403).send("User is not authorized"):void c()},exports.cerrarmonth=function(a,b,c){},exports.lastcierre=function(a,b,c){Cierre.nextCount(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};