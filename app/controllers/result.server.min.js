"use strict";var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=a.query.endDate,f=a.query.startDate;console.log(e);var g={start:(d-1)*c,count:c};Result.find({created:{$gte:f,$lte:e}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").sort({ResultId:-1}).page(g,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):(console.log(c),void b.jsonp(c))})})},exports.list=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=(a.query.search,a.query.sDateResult.replace(/['"]+/g,"")),f=a.query.eDateResult.replace(/['"]+/g,""),g=(a.query.ordering,{start:(d-1)*c,count:c});Result.find({created:{$gte:e,$lte:f}}).page(g,function(a,c){return a?(console.log(a),b.status(400).send({message:getErrorMessage(a)})):void b.jsonp(c)})},exports.getResultbyOrder=function(a,b){a.query.orderId;Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){
return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};var mongoose=require("mongoose"),errorHandler=require("./errors.server.controller"),Result=mongoose.model("Result"),deepPopulate=require("mongoose-deep-populate")(mongoose),getErrorMessage=function(a){var b="";if(a.code)switch(a.code){case 11e3:case 11001:b="Este Pais ya existe";break;default:b="Se ha producido un error"}else for(var c in a.errors)a.errors[c].message&&(b=a.errors[c].message);return b};exports.create=function(a,b){var c=new Result(a.body);c.user=a.user,c.save(function(a){return a?11e3===a.code?b.status(401).send({message:"Reporte ya existe"}):b.status(400).send({message:getErrorMessage(a)}):void b.jsonp(c)})},exports.getList=function(a,b){Result.find().populate("clinica").populate("doctor").populate("patientReport").sort({created:-1}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.listpage=function(a,b){var c=a.query.count||25,d=a.query.page||1,e=JSON.parse(a.query.date),f=JSON.parse(a.query.search),g=new Date(e.endDate),h=g.getFullYear(),i=g.getMonth(),j=g.getDate(),k=new Date(e.startDate),l=k.getFullYear(),m=k.getMonth(),n=k.getDate(),o=l+"-"+("0"+(m+1)).slice(-2)+"-"+("0"+n).slice(-2),p=h+"-"+("0"+(i+1)).slice(-2)+"-"+("0"+j).slice(-2),q={start:(d-1)*c,count:c},r={};r=f.doctor&&!f.paciente?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status,doctor:mongoose.Types.ObjectId(f.doctor)}:f.paciente&&!f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",patientReport:mongoose.Types.ObjectId(f.paciente)}:f.paciente&&f.doctor?{tipomuestraDesc:f.sereal?f.sereal:"",seguroDesc:f.seguro?f.seguro:"",reportStatus:f.status?f.status:"",doctor:mongoose.Types.ObjectId(f.doctor),patientReport:mongoose.Types.ObjectId(f.paciente)}:{tipomuestraDesc:f.sereal?f.sereal:"",reportStatus:f.status?f.status:"",seguroDesc:f.seguro?f.seguro:""};var s={filters:{mandatory:r}};Result.find({created:{$gte:o,$lte:p}}).populate("orders").populate("patientReport").populate("patientReport.locations").populate("doctor").filter(s).sort({tipomuestra:1,tipomuestraDesc:1,rSereal:1}).page(q,function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void Result.populate(c,{path:"patientReport.locations",model:"locations"},function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})})},exports.getResultbyOrder=function(a,b){a.query.orderId,Result.find({orders:a.query.orderId}).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultbyId=function(a,b){var c=a.body.resultId;Result.find({_id:c}).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultBy=function(a,b){var c=a.query;console.log(c),Result.find(c).populate("user","displayName").populate("orders").populate("patientReport").populate("seguroId").populate("clinica").populate("doctor").exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.getResultMaxByType=function(a,b){var c=a.body.resultType;Result.find({tipomuestra:c}).sort({ResultId:-1}).limit(1).exec(function(a,c){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})},exports.read=function(a,b){b.jsonp(a.result)},exports.resultByID=function(a,b,c,d){Result.findById(d).populate("user","displayName").populate("orders").exec(function(b,e){return b?c(b):e?(a.result=e,void c()):c(new Error("Failed to load procs "+d))})},exports.update=function(a,b){var c=a.result;c.resultado=a.body.resultado?a.body.resultado:c.resultado,c.diagnostico=a.body.diagnostico?a.body.diagnostico:c.diagnostico,c.noAutho=a.body.noAutho?a.body.noAutho:c.noAutho,c.updateDate=new Date,c.updatedUser=a.body.updatedUser?a.body.updatedUser:c.updatedUser,c.reportStatus=a.body.reportStatus?a.body.reportStatus:c.reportStatus,c.total=a.body.total?a.body.total:c.total,c.nota=a.body.nota?a.body.nota:c.nota,c.tecnica=a.body.tecnica?a.body.tecnica:c.tecnica,c.costo=a.body.costo?a.body.costo:c.costo,c.pago=a.body.pago?a.body.pago:c.pago,c.debe=a.body.debe,c.patientReport=a.body.patientReport?a.body.patientReport:c.patientReport,c.seguroId=a.body.seguroId?a.body.seguroId:c.seguroId,c.doctor=a.body.doctor?a.body.doctor:c.doctor,c.clinica=a.body.clinica?a.body.clinica:c.clinica,c.seguroDesc=a.body.seguroDesc?a.body.seguroDesc:c.seguroDesc,c.created=a.body.created?a.body.created:c.created,c.createdDateDoctor=a.body.createdDateDoctor?a.body.createdDateDoctor:c.createdDateDoctor,console.log(c),c.save(function(a){return a?b.status(400).send({message:errorHandler.getErrorMessage(a)}):void b.jsonp(c)})};