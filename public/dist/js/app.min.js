"Use strict";angular.module("ciudad",["pais"]),angular.module("ciudad").config(["$stateProvider",function(a){a.state("ciudad",{url:"/ciudad",templateUrl:"ciudad/views/list-ciudad.client.view.html"})}]);var ciudadModule=angular.module("ciudad");ciudadModule.controller("ciudadController",["$scope","$http","$routeParams","$location","Authentication","Ciudad","Pais","Notify","$modal","$log",function(a,b,c,d,e,f,g,h,i,j){"use strict";this.authentication=e,this.ciudad=f.query(),this.modelCreate=function(a){var b=i.open({templateUrl:"ciudad/views/create-ciudad.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){j.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=i.open({templateUrl:"ciudad/views/edit-ciudad.client.view.html",controller:["$scope","$modalInstance","ciudad",function(a,b,d){a.ciudad=d,a.ciudad.rpais=c.pais._id,h.sendbroadCast("noError","this is a message"),a.ok=function(){b.close(a.ciudad)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{ciudad:function(){return c}}});d.result.then(function(b){a.selected=b},function(){j.info("Modal dismissed at: "+new Date)})},this.remove=function(a){if(a){a.$remove();for(var b in this.ciudad)this.ciudad[b]===a&&this.ciudad.splice(b,1)}else this.ciudad.$remove(function(){})}}]),ciudadModule.controller("modalResutl",function(a,b){"use strict";a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}),ciudadModule.controller("CiudadCreateController",["$scope","Ciudad","Notify","Pais",function(a,b,c,d){"use strict";this.pais=d.query(),this.create=function(){var d=new b({name:this.name,pais:this.Selectedpais});d.$save(function(a){c.sendMsg("newPis",{id:a._id})},function(b){a.error=b.data.message})}}]),ciudadModule.controller("ciudadUpdateController",["$scope","Authentication","Ciudad","Pais","Notify",function(a,b,c,d,e){"use strict";this.pais=d.query(),this.update=function(b){var d=new c({_id:b._id,name:b.name,pais:a.ciudad.rpais});d.$update(function(){e.sendMsg("newPis",{id:"update"})},function(b){a.error=b.data.message})}}]),ciudadModule.directive("ciudadList",["Ciudad","Notify",function(a,b){"use strict";return{restrict:"E",transclude:!0,templateUrl:"ciudad/views/ciudad-list.template.html",link:function(c,d,e){b.getMsg("newPis",function(b,d){c.ciudadCtrl.ciudad=a.query()})}}}]),angular.module("ciudad").factory("Ciudad",["$resource",function(a){return a("api/ciudad/:ciudadId",{ciudadId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a),console.log(this.mgs)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]),angular.module("pais",[]),angular.module("pais").config(["$stateProvider",function(a){a.state("pais",{url:"/pais",templateUrl:"pais/views/list-pais.client.view.html"})}]);var paisModule=angular.module("pais");paisModule.controller("PaisController",["$scope","$http","$routeParams","$location","Authentication","Pais","$modal","$log","Notify",function(a,b,c,d,e,f,g,h,i){this.authentication=e,this.pais=f.query(),a.refered=!1,this.modelCreate=function(a){var b=g.open({templateUrl:"pais/views/create-pais.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){h.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=g.open({templateUrl:"pais/views/edit-pais.client.view.html",controller:["$scope","$modalInstance","pais",function(a,b,c){a.pais=c,a.ok=function(){b.close(a.pais)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{pais:function(){return c}}});d.result.then(function(b){a.selected=b},function(){h.info("Modal dismissed at: "+new Date)})},a.$on("handleBroadcast",function(){a.returnPais&&(this.pais=a.returnPais,a.returnPais="")}),this.remove=function(a){if(a){a.$remove();for(var b in this.pais)this.pais[b]===a&&this.pais.splice(b,1)}else this.pais.$remove(function(){})}}]),paisModule.controller("modalResutl",["$scope","$modalInstance",function(a,b){a.$on("noError",function(){b.close(),a.ok=function(){}}),a.cancel=function(){b.dismiss("cancel")}}]),paisModule.controller("PaisCreateController",["$scope","Pais","Notify",function(a,b,c){this.create=function(){var d=new b({name:this.name});d.$save(function(a){c.sendMsg("newPis",{id:a._id}),c.sendbroadCast("noError")},function(b){a.error=b.data.message})}}]),paisModule.controller("PaisUpdateController",["$scope","Authentication","Pais",function(a,b,c){a.authentication=b,this.update=function(b){var c=b;c.$update(function(){},function(b){a.error=b.data.message})}}]),paisModule.directive("paisList",["Pais","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"pais/views/pais-list.template.html",link:["scope","element","attr",function(c,d,e){b.getMsg("newPis",function(b,d){c.paisCtrl.pais=a.query()})}]}}]),angular.module("pais").factory("Pais",["$resource",function(a){return a("api/pais/:paisId",{paisId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(),console.log(this.mgs)},b.broadCast=function(){a.$broadcast("noError")},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]),angular.module("clientes",["pais","ciudad","sector"]),angular.module("clientes").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("listClientes",{url:"/clientes",templateUrl:"clientes/views/list-clientes.client.view.html"})}]);var clienteModule=angular.module("clientes");clienteModule.controller("clienteController",["$scope","$http","$location","Authentication","Pais","Ciudad","Sector","Cliente","Notify","ngTableParams","$modal","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){this.authentication=d;var m={page:1,count:15,filter:{name:name}},n={total:0,counts:[15,20,25],getData:function(b,c){h.get(c.url(),function(d){c.total(d.total),b.resolve(d.results),a.total=d.total})}};a.tableParams=new j(m,n),this.modelCreate=function(a){var b=k.open({templateUrl:"clientes/views/create-clientes.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){l.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=k.open({templateUrl:"clientes/views/edit-clientes.client.view.html",controller:["$scope","$modalInstance","cliente",function(a,b,d){a.cliente=d,a.cliente.rpais=c.pais,a.cliente.rciudad=c.ciudad,a.cliente.rsector=c.sector,a.ok=function(){b.close(a.cliente)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{cliente:function(){return c}}});d.result.then(function(b){a.selected=b},function(){l.info("Modal dismissed at: "+new Date)})},a.doSearch=function(){a.tableParams.reload()},i.getMsg("clinicaLoad",function(b,c){a.doSearch(),alertify.success("Acción realizada exitosamente!! !!")}),this.modelRemove=function(b,c){a.cliente=c;var d=k.open({templateUrl:"clientes/views/clientes-delete.template.html",controller:["$scope","$modalInstance","cliente",function(a,b,c){a.cliente=c,a.ok=function(){b.close(a.cliente)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{cliente:function(){return c}}});d.result.then(function(b){a.selected=b},function(){l.info("Modal dismissed at: "+new Date)})},a.remove=function(a){if(a){a.$remove();for(var b in this.cliente)this.cliente[b]===a&&this.cliente.splice(b,1)}else this.cliente.$remove(function(){})}}]),clienteModule.controller("clienteDeleteController",["$scope","Authentication","Cliente","Notify",function(a,b,c,d){this["delete"]=function(b){var e=new c({_id:a.cliente._id});e.$remove(function(){d.sendMsg("clinicaLoad",{id:"nada"})},function(b){a.error=b.data.message})}}]),clienteModule.controller("clienteUpdateController",["$scope","Authentication","Cliente","Notify","Pais","Ciudad","Sector","$mdToast","$animate",function(a,b,c,d,e,f,g,h,i){this.pais=e.query(),this.ciudad=f.query(),this.sector=g.query(),this.filterByPais=function(){this.sector={}},this.filterByCiudad=function(){this.sector=g.query()},this.update=function(b){var e=new c({_id:b._id,name:b.name,tipo:b.tipo,clienteRNC:b.clienteRNC,clienteTelefono:b.clienteTelefono,pais:a.cliente.rpais,ciudad:a.cliente.rciudad,sector:a.cliente.rsector,clienteDireccion:b.clienteDireccion});e.$update(function(){d.sendMsg("clinicaLoad",{id:"nada"})},function(b){a.error=b.data.message})}}]),clienteModule.controller("modalResutl",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}),clienteModule.controller("clienteCreateController",["$scope","Cliente","Notify","Pais","Ciudad","Sector",function(a,b,c,d,e,f){this.pais=d.query(),this.filterByCity=function(){this.ciudad=e.query(),this.sector=""},this.filterSector=function(){this.sector=f.query()},this.create=function(){var d=new b({name:this.name,tipo:"A",clienteRNC:this.clienteRNC,clienteTelefono:this.clienteTelefono,pais:this.clientePais,ciudad:this.clienteCiudad,sector:this.clienteSector,clienteDireccion:this.clienteDireccion});d.$save(function(a){c.sendMsg("clinicaLoad",{id:"nada"})},function(b){a.error=b.data.message})}}]),clienteModule.directive("clienteList",["Cliente","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"clientes/views/clientes-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(b,c){a.clienteCtrl.doSearch()})}}}]),angular.module("clientes").factory("Cliente",["$resource",function(a){return a("/api/clientes/:clienteId",{clienteId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a),console.log(this.mgs)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]).factory("ClientAction",["$http","$q",function(a,b){var c={};return c.getSegurosList=function(){var c=b.defer();return a.post("cliente/getList").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},c}]).service("ClienteService",["$http","$q",function(a,b){var c={result:[],load:function(){var d=b.defer();return a.post("cliente/getList").success(function(a){0!==a.length&&angular.forEach(a,function(a){c.result.push(a)}),d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}};return c.load(),c}]),angular.module("doctor",["pais","ciudad","sector","clientes"]),angular.module("doctor").config(["$stateProvider",function(a){a.state("listDoctors",{url:"/doctors",templateUrl:"doctors/views/list-doctor.client.view.html"})}]);var doctorModule=angular.module("doctor");doctorModule.controller("doctorsController",["$scope","$http","$routeParams","$location","Doctors","Authentication","ngTableParams","$modal","$log","Pais","Ciudad","Sector","Cliente","NotifyPatient",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={page:1,count:15,filter:{name:name,clinica:""}},p={total:0,counts:[15,20,25],getData:function(b,c){e.get(c.url(),function(d){c.total(d.total),b.resolve(d.results);for(var e=0;e<d.results.length;e++)d.results[e].clinica="",d.results[e].clinica=d.results[e].clinicaList.length>0?d.results[e].clinicaList[0].clinica:"";a.total=d.total})}};a.calculateAge=function(a){var b=Date.now()-a.getTime();new Date(b)},a.tableParams=new g(o,p),this.modelRemove=function(b,c){a.doctor=c;var d=h.open({templateUrl:"doctors/views/doctor-delete.template.html",controller:["$scope","$modalInstance","doctor",function(a,b,c){a.doctor=c,a.ok=function(){b.close(a.doctor)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{doctor:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=h.open({animation:!0,templateUrl:"doctors/views/edit-doctor.client.view.html",controller:["$scope","$modalInstance","doctor",function(a,b,d){a.doctor=d,a.doctor.rClinicaList=c.clinicaList,a.doctor.rpais=c.pais,a.doctor.rciudad=c.ciudad,a.doctor.rsector=c.sector,a.ok=function(){b.close(a.doctor)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{doctor:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.modelCreate=function(b,c){var d=h.open({templateUrl:"doctors/views/create-doctor.client.view.html",controller:["$scope","$modalInstance","doctor",function(a,b,c){a.ok=function(){b.close(a.doctor)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{doctor:function(){return c}}});d.result.then(function(b){a.createdDoctor=b},function(){i.info("Modal dismissed at: "+new Date)})},a.doSearch=function(){a.tableParams.reload()},n.getMsg("doctorsaved",function(b,c){a.doSearch()})}]),doctorModule.controller("doctorCreateController",["$scope","$http","$routeParams","Authentication","DoctorsService","Doctors","Pais","Ciudad","Sector","Cliente","Notify","$mdToast","$animate","NotifyPatient","$modal",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){b.post("cliente/getList").success(function(a){q.cliente=a}).error(function(a){})}var q=this;a.doctorServices=e,q.ClinicaList=[],q.pais=g.query(),q.ciudad=h.query(),q.sector=i.query(),p(),k.getMsg("clinicaLoad",function(a,b){console.log("resive"),p()}),q.AddClinica=function(){var a=document.getElementById("clinicaDoctor"),b=a.options[a.selectedIndex].text;if(q.ClinicaList.length<=0)q.ClinicaList.push({id:this.clientes,clinica:b});else{for(var c=0;c<q.ClinicaList.length;c++)if(q.ClinicaList[c].id===this.clientes)return void alertify.error("Esta clinica ya esta asociada");q.ClinicaList.push({id:q.clientes,clinica:b})}},q.deleteClinica=function(a){q.ClinicaList.splice(a,1)},q.filterByPais=function(){this.sector={}},q.filterByCiudad=function(){this.sector=i.query()},q.DoctorCI={},a.authentication=d,a.referred=!0,q.showPatientSave=function(){l.show(l.simple().content("Nuevo Paciente Guardado!!").position("bottom right").hideDelay(3e3))},q.create=function(b){a.doctorServices.checkDoctor(b).then(function(b){if(b===!0)alertify.error("Doctor ya existe!!");else{a.ok();var c={tipo:q.DoctorCI?q.DoctorCI.tipo:"",value:q.DoctorCI?q.DoctorCI.value:""},d=new f({DoctorCI:c,firstName:q.firstName,lastName:q.lastName,DoctorTelefono:q.DoctorTelefono,DoctorTelefonoOff:q.DoctorTelefonoOff,DoctorSexo:q.DoctorSexo,DoctorEmail:q.DoctorEmail,DoctorDireccion:q.DoctorDireccion,pais:q.doctorPais,ciudad:q.doctorCiudad,sector:q.doctorSector,clinicaList:q.ClinicaList});d.$save(function(a){n.sendMsg("doctorsaved",{doctorSavedInfo:a})},function(b){a.error=b.data.message,console.log(a.error)})}})}}]),doctorModule.controller("doctorUpdateController",["$scope","$http","$routeParams","Authentication","Doctors","OrderServices","Pais","Ciudad","Sector","Cliente","NotifyPatient","$mdToast","$animate","ClienteService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=this;a.OrderServices=f,this.pais=g.query(),this.ciudad=h.query(),this.sector=i.query(),this.ClientList=[],b.post("cliente/getList").success(function(a){o.cliente=a,console.log(o.cliente)}).error(function(a){}),this.AddClinica=function(){var b=document.getElementById("clinicaDoctor"),c=b.options[b.selectedIndex].text;if(a.doctor.rClinicaList.length<=0)a.doctor.rClinicaList.push({id:this.clientes,clinica:c});else{for(var d=0;d<a.doctor.rClinicaList.length;d++)if(a.doctor.rClinicaList[d].id===this.clientes)return void alertify.error("Esta clinica ya esta asociada");a.doctor.rClinicaList.push({id:this.clientes,clinica:c})}},this.deleteClinica=function(b){console.log(b),a.doctor.rClinicaList.splice(b,1)},this.filterByPais=function(){this.sector={}},this.filterByCiudad=function(){this.sector=i.query()},this.showDoctorSave=function(){l.show(l.simple().content("Nuevo Paciente Guardado!!").position("bottom right").hideDelay(3e3))},this.update=function(b){b.DoctorCI&&(this.DoctorCI={tipo:b.DoctorCI.tipo,value:b.DoctorCI.value});var c=new e({_id:b._id,DoctorCI:this.DoctorCI,firstName:b.firstName,lastName:b.lastName,DoctorEmail:b.DoctorEmail,DoctorTelefono:b.DoctorTelefono,DoctorTelefonoOff:b.DoctorTelefonoOff,DoctorSexo:this.DoctorSexo,DoctorDireccion:b.DoctorDireccion,pais:a.doctor.rpais,ciudad:a.doctor.rciudad,sector:a.doctor.rsector,clinicaList:a.doctor.rClinicaList});c.$update(function(b){a.OrderServices.selectedDoctor&&a.OrderServices.selectedDoctor._id===b._id&&a.OrderServices.setDoctorDetail(a.OrderServices.selectedDoctor._id)},function(b){a.error=b.data.message})}}]),doctorModule.controller("doctorDeleteController",["$scope","Authentication","Doctors","Notify","$mdToast","$animate","NotifyPatient",function(a,b,c,d,e,f,g){a.authentication=b,this["delete"]=function(b){var d=new c({_id:a.doctor._id});d.$remove(function(){g.sendMsg("doctorsaved",{doctorSavedInfo:""})},function(b){a.error=b.data.message})},this.showSimpleToast=function(){e.show(e.simple().content("Doctor Eliminado!!").position("bottom right").hideDelay(3e3))}}]),doctorModule.directive("doctorsList",["Patients","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"doctors/views/doctor-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(b,c){a.doctorsCtrl.doSearch()})}}}]),doctorModule.directive("doctorsContact",function(){return{restrict:"E",transclude:!0,templateUrl:"doctors/template/doctor-contact-template.html"}}),doctorModule.directive("doctorsClinica",function(){return{restrict:"E",transclude:!0,templateUrl:"doctors/template/doctor-clinica-template.html"}}),doctorModule.directive("doctorscreateContact",function(){return{restrict:"E",transclude:!0,templateUrl:"doctors/template/doctorcreate-contact-template.html"}}),doctorModule.directive("doctorscreateClinica",function(){return{restrict:"E",transclude:!0,templateUrl:"doctors/template/doctorcreate-clinica-template.html"}}),angular.module("doctor").factory("Doctors",["$resource",function(a){return a("api/doctors/:doctorId",{doctorId:"@_id"},{update:{method:"PUT"},save:{method:"POST",isArray:!1}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]).service("DoctorsService",["$http","$q","Doctors",function(a,b,c){var d={result:[],selectedDoctor:null,refresh:function(){return d.result=[],d.load()},checkDoctor:function(a){var c=b.defer();return d.load().then(function(){for(var b=!1,e=0;e<d.result.length;e++)if(d.result[e].firstName&&d.result[e].lastName){var f=d.result[e].firstName.trim()+" "+d.result[e].lastName.trim(),g=a.firstName.trim()+" "+a.lastName.trim();if(f.toLowerCase()===g.toLowerCase())return b=!0,void c.resolve(b)}c.resolve(b)}),c.promise},load:function(){d.result=[];var c=b.defer();return a.post("doctor/getList").success(function(a){0!==a.length&&angular.forEach(a,function(a){d.result.push(a)}),c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}};return d.load(),d}]),angular.module("patients",["pais","ciudad","sector","clientes"]),angular.module("patients").config(["$stateProvider",function(a){"use strict";a.state("patients",{url:"/patients",templateUrl:"patients/views/list-patients.client.view.html"})}]);var patientModule=angular.module("patients");patientModule.controller("pacientsController",["$scope","$http","$routeParams","$location","Authentication","Patients","ngTableParams","$modal","$log","Pais","Ciudad","Sector","Cliente","NotifyPatient","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.isSaving=!1;var p={page:1,count:15,filter:{name:name}},q={total:0,counts:[15,20,25],getData:function(b,c){f.get(c.url(),function(d){c.total(d.total),b.resolve(d.results),a.total=d.total})}};a.tableParams=new g(p,q),n.getMsg("saved",function(b,c){a.tableParams.reload(),a.isSaving=!1}),n.getMsg("updating",function(b,c){a.isSaving=!0}),n.getMsg("updated",function(b,c){a.tableParams.reload(),a.isSaving=!1,alertify.success("Acción realizada exitosamente!! !!")}),this.modelRemove=function(b,c){a.patient=c;var d=h.open({templateUrl:"patients/views/patient-delete.template.html",controller:function(a,b,c){a.patient=c,a.ok=function(){b.close(a.patient)},a.cancel=function(){b.dismiss("cancel")}},size:b,resolve:{patient:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=h.open({animation:!0,templateUrl:"patients/views/edit-patient.client.view.html",controller:["$scope","$modalInstance","patient",function(a,b,d){a.patient=d,a.patient.rpais=c.pais?c.pais._id:"",a.patient.rciudad=c.ciudad?c.ciudad._id:"",a.patient.rsector=c.sector?c.sector._id:"",a.patient.rcliente=c.clientes?c.clientes._id:"",a.patient.rlocation=c.locations?c.locations._id:"",a.ok=function(){b.close(a.patient)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{patient:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.modelCreate=function(a){var b=h.open({templateUrl:"patients/views/create-patient.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){i.info("Modal dismissed at: "+new Date)})},this.doSearch=function(){a.tableParams.reload()}}]),patientModule.controller("PatientsCreateController",["$scope","$http","$routeParams","Authentication","Patients","Pais","Ciudad","Sector","Cliente","NotifyPatient","$mdToast","$animate",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=this;this.paisD=f.query(),this.ciudad=g.query(),this.sector=h.query(),this.cliente=i.get(),b.post("locations/getList").success(function(a){m.cliente=a}).error(function(a){}),this.filterByCity=function(){null===this.pais?(this.ciudad=null,this.sector=null,this.patientSector=null):(this.ciudad=g.query(),this.sector=null,this.patientSector=null)},this.filterSector=function(){null===this.pais||null===this.ciudad?this.sector=null:this.sector=h.query()},this.calculateAge=function(){},this.PatientCI={},a.authentication=d,a.referred=!0,this.showPatientSave=function(){k.show(k.simple().content("Nuevo Paciente Guardado!!").position("bottom right").hideDelay(3e3))},this.create=function(){j.sendMsg("saving",{id:"nada"}),this.PatientCI={tipo:this.PatientCI.tipo,value:this.PatientCI.tipovalue};var b=new e({PatientCI:this.PatientCI,patientFirstName:this.patientFirstName,patientLastName:this.patientLastName,patientDOB:this.patientDOB,patientEdad:this.patientEdad,patientSexo:this.patientSexo,locations:this.clientes,patientEC:this.patientEC,patientTelefono:this.patientTelefono,clientes:this.clientes,patientPolisa:this.patientPolisa,patientDireccion:this.patientDireccion,pais:this.pais,ciudad:this.patientCiudad,sector:this.patientSector});b.$save(function(a){j.sendMsg("saved",{patientSavedInfo:a}),j.sendMsg("patientsaved",{patientSavedInfo:a})},function(b){a.error=b.data.message})}}]),patientModule.controller("PatientsUpdateController",["$scope","$http","$routeParams","Authentication","Patients","Pais","Ciudad","Sector","Cliente","NotifyPatient","$mdToast","$animate","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=this;a.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"1900:-0"},this.pais=f.query(),this.ciudad=g.query(),this.sector=h.query(),b.post("locations/getList").success(function(a){n.location=a}).error(function(a){}),this.filterByCity=function(){null===this.pais?(this.ciudad=null,this.sector=null,this.patientSector=null):(this.ciudad=g.query(),this.sector=null,this.patientSector=null)},this.filterSector=function(){null===this.pais||null===this.ciudad?this.sector=null:this.sector=h.query()},this.filterByCiudad=function(){this.sector=h.query()},this.showPatientSave=function(){k.show(k.simple().content("Nuevo Paciente Guardado!!").position("bottom right").hideDelay(3e3))},this.update=function(a){j.sendMsg("updating",{id:"nada"}),this.PatientCI={tipo:a.PatientCI?a.PatientCI.tipo:"",value:a.PatientCI?a.PatientCI.value:""};var b=new e({_id:a._id,PatientCI:this.PatientCI,patientFirstName:a.patientFirstName,patientLastName:a.patientLastName,patientDOB:a.patientDOB,patientEdad:a.patientEdad,patientSexo:a.patientSexo,patientEC:a.patientEC,patientTelefono:a.patientTelefono,clientes:a.rcliente?a.rcliente:null,locations:a.rlocation?a.rlocation:null,patientPolisa:a.patientPolisa,patientDireccion:a.patientDireccion,pais:a.rpais?a.rpais:null,ciudad:a.rciudad?a.rciudad:null,sector:a.rsector?a.rsector:null});b.$update(function(a){j.sendMsg("updated",{id:"nada"}),j.sendMsg("patientsaved",{patientSavedInfo:a})},function(a){})}}]),patientModule.controller("patientDeleteController",["$scope","Authentication","Patients","NotifyPatient","$mdToast","$animate",function(a,b,c,d,e,f){"use strict";a.authentication=b,this["delete"]=function(b){var e=new c({_id:a.patient._id});e.$remove(function(){d.sendMsg("removed",{id:"nada"})},function(b){a.error=b.data.message})},this.showSimpleToast=function(){e.show(e.simple().content("Paciente Eliminado!!").position("bottom right").hideDelay(3e3))}}]),patientModule.directive("phone",function(){"use strict";return{restrice:"A",require:"ngModel",link:function(a,b,c,d){var e=/^[(]{0,1}[0-9]{3}[)\.\- ]{0,1}[0-9]{3}[\.\- ]{0,1}[0-9]{4}$/;angular.element(b).bind("blur",function(){var a=this.value;e.test(a)?angular.element(this).next().next().css("display","none"):angular.element(this).next().next().css("display","block")})}}}),patientModule.directive("patientList",["Patients","NotifyPatient",function(a,b){"use strict";return{restrict:"E",transclude:!0,templateUrl:"patients/views/patients-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(b,c){a.pacientsCtrl.doSearch()})}}}]),angular.module("patients").factory("Patients",["$resource",function(a){return a("api/patients/:patientId",{patientId:"@_id"},{update:{method:"PUT"},save:{method:"POST",isArray:!1}})}]).factory("NotifyPatient",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(),console.log(this.mgs)},b.broadCast=function(){a.$broadcast("noError")},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]).service("PatientServices",["$http","$q",function(a,b){var c={results:[],load:function(){var d=b.defer();return a.post("patient/getList").success(function(a){0!==a.length&&angular.forEach(a,function(a){c.results.push(a)}),d.resolve(a)}).error(function(a){}),d.promise}};return c.load(),c}]),angular.module("procs",[]),angular.module("procs").config(["$stateProvider",function(a){a.state("procs",{url:"/procs",templateUrl:"procedimientos/views/list-procedimientos.client.view.html"})}]);var procsModule=angular.module("procs");procsModule.controller("procsController",["$scope","$http","$routeParams","$location","Authentication","Procs","Notify","$modal","$log","ngTableParams","$mdToast","$animate",function(a,b,c,d,e,f,g,h,i,j,k,l){this.authentication=e;var m={page:1,count:5,filter:{name:name}},n={total:0,counts:[5,10,15],getData:function(b,c){f.get(c.url(),function(d){c.total(d.total),b.resolve(d.results),a.total=d.total})}};a.tableParams=new j(m,n),this.modelCreate=function(a){var b=h.open({templateUrl:"procedimientos/views/create-procedimientos.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){i.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=h.open({templateUrl:"procedimientos/views/edit-procedimientos.client.view.html",controller:function(a,b,c){a.procs=c,g.sendbroadCast("noError","this is a message"),a.ok=function(){b.close(a.procs)},a.cancel=function(){b.dismiss("cancel")}},size:b,resolve:{procs:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.modelRemove=function(b,c){a.procs=c;var d=h.open({templateUrl:"procedimientos/views/procedimientos-delete.template.html",controller:function(a,b,c){a.procs=c,a.ok=function(){b.close(a.procs)},a.cancel=function(){b.dismiss("cancel")}},size:b,resolve:{procs:function(){return c}}});d.result.then(function(b){a.selected=b},function(){i.info("Modal dismissed at: "+new Date)})},this.doSearch=function(){a.tableParams.reload()},this.remove=function(a){if(a){a.$remove();for(var b in this.seguro)this.seguro[b]===a&&this.seguro.splice(b,1)}else this.seguro.$remove(function(){})}}]),procsModule.controller("modalResutl",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}),procsModule.controller("procsCreateController",["$scope","Procs","NotifyPatient","$mdToast","$animate",function(a,b,c,d,e){this.create=function(){var d=new b({name:this.name,costo:this.costo,proType:this.proType});d.$save(function(a){c.sendMsg("procsaved",{procSavedInfo:a})},function(b){401===b.status?alertify.error("Este nombre ya existe!!"):alertify.error("No se pudo completar la operación!!"),a.error=b.data.message})}}]),procsModule.controller("procsDeleteController",["$scope","Authentication","Procs","Notify","$mdToast","$animate",function(a,b,c,d,e,f){a.authentication=b,this["delete"]=function(b){var e=new c({_id:a.procs._id});e.$remove(function(){d.sendMsg("newPis",{id:"nada"})},function(b){a.error=b.data.message})},this.showSimpleToast=function(){e.show(e.simple().content("Procedimiento Eliminado!!").position("bottom right").hideDelay(3e3))}}]),procsModule.controller("procsUpdateController",["$scope","Authentication","Notify","Procs","$mdToast","$animate",function(a,b,c,d,e,f){this.update=function(b){var e=new d({_id:b._id,name:b.name,costo:b.costo,proType:b.proType});e.$update(function(){c.sendMsg("newPis",{id:"update"})},function(b){a.error=b.data.message})},this.showSimpleUdpdate=function(){e.show(e.simple().content("Procedimiento Guardado!!").position("bottom right").hideDelay(3e3))}}]),clienteModule.directive("procsList",["Procs","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"procedimientos/views/procedimientos-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(b,c){a.procsCtrl.doSearch()})}}}]),angular.module("procs").factory("Procs",["$resource",function(a){return a("procs/:procsId",{procsId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a),console.log(this.mgs)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]),angular.module("result",["orders","tempresult"]),angular.module("result").config(["$stateProvider",function(a){a.state("result",{url:"/result",templateUrl:"result/views/result-clientes.client.view.html"}).state("resultId",{url:"/result/:resultId",templateUrl:"results/views/edit-result.client.view.html"})}]);var resultModule=angular.module("result");resultModule.controller("resultController",["$scope","$http","$stateParams","$location","Authentication","Result","Orders","Notify","ngTableParams","$modal","$log","ConvertArray","GetResults","resultServices",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.authentication=e;c.resultId;a.resultId=c.resultId.replace(":",""),a.resultServices=n,a.resultServices.getResults().then(function(){a.resultServices.selectedResult=a.resultServices.getResultById(a.resultId),"C"===a.resultServices.selectedResult.tipomuestra?a.resultServices.reportName="Reporte Citológico":a.resultServices.reportName="Reporte Histopatológico","B"===a.resultServices.selectedResult.tipomuestra?a.resultServices.tecnica="Hematoxilina, Eosina":"BG"===a.resultServices.selectedResult.tipomuestra&&(a.resultServices.tecnica="Hematoxilina, Eosina \nHistoquímica de Waysson para HP",a.resultServices.selectedResult.nota?a.resultServices.notaResult=a.resultServices.selectedResult.nota:a.resultServices.notaResult="La nota para las Biosia Gastrica siempre tendra nota: la técnica histoquímica de Waysson para helicobacter pylori resulto positivo (se identifican moderados microorganismos espiralados igual a 2 en una escala de 0 a 3) y Tecnica"),
a.resultServices.resultado=a.resultServices.selectedResult.resultado}),a.update=function(){a.resultServices.update(a.resultServices.muestra).then(function(){d.path("/orders")})}}]),resultModule.controller("resultUpdateController",["$scope","$http","$stateParams","Orders","ngTableParams","Notify","$mdToast","$animate","$modal","$log",function(a,b,c,d,e,f,g,h,i,j){}]),resultModule.controller("resultListController",["$scope","$http","$stateParams","Orders","ngTableParams","Notify","$mdToast","$animate","$modal","$log","$location","resultServices","OrderServices","lodash",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){var b=new Date(a.date.startDate),c=new Date(a.date.endDate),d={startDate:b,endDate:c};return d}function p(c,d,e){var f=e.startDate;b.get("/api/result",{params:{page:c,count:25,filter:d,startDate:f,endDate:e.endDate}}).then(function(c){a.users=c.data.results,a.totalUsers=c.data.total,b.get("/api/result",{params:{page:1,count:a.totalUsers,filter:d,startDate:f,endDate:e.endDate}}).then(function(b){a.printReport=b.data.results,a.total={costo:0,pago:0,debe:0,seguro:0};for(var c=0;c<b.data.results.length;c++)a.total.costo=parseInt(a.total.costo)+parseInt(b.data.results[c].costo?b.data.results[c].costo:0),a.total.pago=parseInt(a.total.pago)+parseInt(b.data.results[c].pago?b.data.results[c].pago:0),a.total.debe=parseInt(a.total.debe)+parseInt(b.data.results[c].debe?b.data.results[c].debe:0),a.total.seguro=parseInt(a.total.seguro)+parseInt(b.data.results[c].seguroId?1:0)})})}a.services=l,a.orders=m,a.services.date.startDate=moment().subtract("days",1),a.services.date.endDate=moment(),a.loadMore=function(b,c){a.services.page=b,a.services.loadResult(b)},a.resetSearchForm=function(){a.services.date.startDate=moment().subtract("days",1),a.services.date.endDate=moment(),a.services.resetForm()},a.filterResult=function(){a.services.filterResult()},f.getMsg("newOrderPost",function(b,c){console.log("posted"),a.services.filterResult()}),a.dateChange=function(b,c){p(a.cPage,c,o())},a.pageChanged=function(b,c,d){new Date(a.date.startDate),new Date(a.date.endDate);p(b,c,o())},a.setResult=function(a){k.path("/result/:"+a._id)},a.setUpdate=function(a){f.sendMsg("orderUpdate",{resultInfo:a})}}]),resultModule.directive("ngPrint",function(){function a(a,c,d){c.on("click",function(){var a=document.getElementById(d.printElementId),c=document.getElementById("createtemplateForm");c.classList.add("hide"),a&&(b(a),c.classList.remove("hide"))})}function b(a){c.innerHTML="",c.appendChild(a),window.print()}var c=document.getElementById("printSection");return c?c.innerHTML="":(c=document.createElement("div"),c.id="printSection",document.body.appendChild(c)),{link:a,restrict:"A",controller:function(a){}}}),resultModule.service("resultServices",["$q","$timeout","$http","Result","Authentication","$rootScope",function(a,b,c,d,e,f){var g={resultList:[],Results:[],search:{},date:{},params:{},totales:{},paramsPrint:{},notaResult:null,tecnica:null,hasMore:!0,page:1,total:0,count:25,selectedResult:null,isPrinting:!1,resultado:{},test:null,reportName:null,papObservation:null,loadResult:function(){var b=a.defer();return g.params={page:g.page,search:g.search,date:g.date,ordering:g.ordering},d.get(g.params,function(a){g.total=a.total,b.resolve(a),g.Results=[],a.results&&(angular.forEach(a.results,function(a){g.Results.push(a)}),g.paramsPrint={page:1,search:g.search,date:g.date,count:g.total},d.get(g.paramsPrint,function(a){g.printReport=a.results,g.totales={costo:0,pago:0,debe:0,seguro:0};for(var b=0;b<a.results.length;b++)g.totales.costo=parseInt(g.totales.costo)+parseInt(a.results[b].costo?a.results[b].costo:0),g.totales.pago=parseInt(g.totales.pago)+parseInt(a.results[b].pago?a.results[b].pago:0),g.totales.debe=parseInt(g.totales.debe)+parseInt(a.results[b].debe?a.results[b].debe:0),g.totales.seguro=parseInt(g.totales.seguro)+parseInt(a.results[b].seguroId?1:0)})),g.count>=a.total&&(g.hasMore=!1)},function(a){b.reject()}),b.promise},filterResult:function(){g.Results=[],g.count=25,g.loadResult()},resetForm:function(){g.search={},g.filterResult()},loadMore:function(a){g.hasMore&&(g.count+=g.count,g.loadResult())},getResults:function(){var b=a.defer();return c.post("result/getList").success(function(a){a&&(g.resultList=[],angular.forEach(a,function(a){g.resultList.push(a),b.resolve()}))}).error(function(a){}),b.promise},getResultById:function(a){for(var b=0;b<g.resultList.length;b++){var c=g.resultList[b];if(c._id===a)return c}},update:function(b){var c=a.defer(),f=new d({_id:g.selectedResult._id,resultado:g.resultado,nota:g.nota,tecnica:g.tecnica,noAutho:g.selectedResult.noAutho,updatedUser:e.user._id,reportStatus:"Listo"});return f.$update(function(){c.resolve()},function(a){c.reject()}),c.promise},watchFilters:function(){f.$watch(function(){return g.search.paciente},function(a){a&&angular.isDefined(a)&&g.loadResult()}),f.$watch(function(){return g.search.doctor},function(a){a&&angular.isDefined(a)&&g.loadResult()}),f.$watch(function(){return g.search.seguro},function(a){angular.isDefined(a)&&g.loadResult()}),f.$watch(function(){return g.search.sereal},function(a){angular.isDefined(a)&&g.loadResult()})}};return g.loadResult(),g.watchFilters(),g}]),resultModule.directive("printCitologia",function(){return{restrict:"E",templateUrl:"results/partials/print-citology.report.html"}}),resultModule.directive("printBiopsia",function(){return{restrict:"E",templateUrl:"results/partials/print-biop.report.html"}}),resultModule.directive("resultBody",function(){return{restrict:"E",templateUrl:"results/partials/result.body.report.html"}}),resultModule.directive("topHeader",function(){return{restrict:"E",templateUrl:"results/partials/report-topHeader.html"}}),resultModule.directive("resultBodypop",function(){return{restrict:"E",templateUrl:"results/partials/result.body.pap.report.html"}}),resultModule.directive("resultPrintpop",function(){return{restrict:"E",templateUrl:"results/partials/result.body.pap.print.report.html"}}),resultModule.directive("resultFooter",function(){return{restrict:"E",templateUrl:"results/partials/footer.html"}}),resultModule.directive("resultDetailreport",function(){return{restrict:"E",templateUrl:"results/partials/result.body.pap.print.report.html"}}),angular.module("result").factory("Result",["$resource",function(a){return a("api/result/:resultId",{resultId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a),console.log(this.mgs)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]).factory("GetResults",["$http",function(a){var b=[],c=function(c){return a.get("api/resultfilter",{params:{orderId:c}}).then(function(a){b=a.data,console.log(b)}),b},d=function(a){for(var b="",c=0;c<a.length;c++)b=b+", "+a[c];return b};return{getResultlist:c,getArrayToString:d}}]),angular.module("orders",["doctor","clientes","patients","procs","result"]),angular.module("orders").config(["$stateProvider",function(a){a.state("orders",{url:"/orders",templateUrl:"orders/views/orders-clientes.client.view.html"}).state("ordenesList",{url:"/ordenesList",templateUrl:"orders/views/list-order.client.view.html"})}]);var ordersModule=angular.module("orders");ordersModule.controller("ordersController",["$scope","$http","$routeParams","$location","Authentication","Doctors","Patients","Cliente","Orders","Notify","ngTableParams","$modal","$log","GetResults",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.authentication=e,a.edit=!1;var o={page:1,count:10};a.data={group1:"Ordenes"};var p={total:0,counts:[10,15,20],getData:function(b,c){i.get(c.url(),function(d){c.total(d.total),b.resolve(d.results),a.total=d.total})}};a.tableParams=new k(o,p),a.openExams=function(b,c){a.edit=b,a.orderExam=n.getResultlist(c._id)},a.modelDetail=function(c,e){var f=l.open({templateUrl:"orders/views/orders-list-details.template.html",controller:function(a,c,f){b.get("api/resultfilter",{params:{orderId:e._id}}).then(function(b){a.orderExam=b.data}),a.ok=function(){c.close(a.patient)},a.cancel=function(){c.dismiss("cancel")},a.setResult=function(a){d.path("/result/:"+a._id)}},size:c,resolve:{patient:function(){return e}}});f.result.then(function(b){a.selected=b},function(){m.info("Modal dismissed at: "+new Date)})}}]),ordersModule.controller("ordersCreateController",["$scope","$http","$routeParams","Doctors","Patients","Cliente","Procs","Orders","ngTableParams","Notify","$mdToast","$animate","$modal","$log","Cierre","Result","$location","CierreControl","$interval","NotifyPatient","PatientServices","$timeout","DoctorsService","lodash","OrderServices",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=this;a.orders=y,a.loadDropDown=function(){a.orders.getprocList(),a.orders.getClinicaList(),a.orders.getPatientList(),a.orders.getDoctorList()},a.init=function(){a.orders.selectedOrder.total=a.orders.selectedOrder.total?a.orders.selectedOrder.total:0,a.orders.selectedOrder.pago=a.orders.selectedOrder.pago?a.orders.selectedOrder.pago:0,a.orders.selectedOrder.debe=a.orders.selectedOrder.debe?a.orders.selectedOrder.debe:0,a.orders.createdDate=moment().format(),a.orders.createdDateDoctor=moment().format(),a.orders.rSereal="",a.orders.createMode=!0,a.orders.clinicaList=a.orders.clinicaList?a.orders.clinicaList:[]},z.valuationDatePickerIsOpen=!1,a.$watch(function(){return z.valuationDatePickerIsOpen},function(a){}),a.log=function(b){a.orders.createdD=b},a.$watch(function(){return z.valuationDatePickerIsOpen1},function(a){}),z.valuationDatePickerOpen=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.valuationDatePickerIsOpen=!0},z.valuationDatePickerOpen1=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.valuationDatePickerIsOpen1=!0},a.init(),a.loadDropDown(),t.getMsg("patientsaved",function(b,c){a.orders.getPatientList().then(function(){a.orders.selectedOrder.patient=c.patientSavedInfo._id,z.setPatientDetail(a.orders.selectedOrder.patient)})}),t.getMsg("doctorUpdate",function(b,c){a.orders.getDoctorList().then(function(){a.orders.selectedOrder.doctorSelected=c.doctorSavedInfo._id,a.orders.selectedDoctor=a.orders.getDoctorById(a.orders.selectedOrder.doctorSelected),a.orders.selectedDoctor.clinicaList.length>0&&(a.orders.clinicaList=a.orders.selectedDoctor.clinicaList)})}),t.getMsg("procsaved",function(b,c){a.orders.getprocList().then(function(){a.orders.selectedOrder.procs=c.procSavedInfo._id})}),j.getMsg("orderUpdate",function(b,c){console.log(c),a.orders.createMode=!1,a.orders.updatedProcs=c.resultInfo,a.orders.selectedOrder.patient=a.orders.updatedProcs.patientReport._id,a.orders.selectedOrder.nota=a.orders.updatedProcs.nota,z.setPatientDetail(a.orders.selectedOrder.patient),a.orders.setDoctorDetail(c.resultInfo.doctor._id),a.orders.selectedOrder.clinica=c.resultInfo.clinica,a.orders.selectedProc=a.orders.getProcById(a.orders.updatedProcs.procs),a.orders.createdDate=moment(a.orders.updatedProcs.created).format("YYYY-MM-DD"),a.orders.createdDateDoctor=moment(a.orders.updatedProcs.createdDateDoctor).format("YYYY-MM-DD"),a.orders.orderDetail=[],a.orders.orderDetail.push({id:c.resultInfo.rSereal,procType:a.orders.selectedProc.proType,name:a.orders.selectedProc.name,costo:a.orders.updatedProcs.costo?a.orders.updatedProcs.costo:0,pago:a.orders.updatedProcs.pago?a.orders.updatedProcs.pago:0}),a.getTotal()}),a.cancelOrder=function(){a.orders.isDeleting=!0,a.orders.clearForm(),a.orders.isDeleting=!1,alertify.success("Acción realizada exitosamente!!")};var A={page:1,count:5},B={total:a.orders.orderDetail.length,getData:function(b,c){b.resolve(a.orders.orderDetail.slice((c.page()-1)*c.count(),c.page()*c.count()))}};a.tableParams=new i(A,B),a.addOrderProcs=function(c){b.get("api/resultFilterBy",{params:{rSereal:a.orders.rSereal.toUpperCase()}}).then(function(b){if(0===b.data.length){a.orders.setProcDetail(c);a.orders.orderDetail=[],a.orders.orderDetail.push({id:a.orders.rSereal,procType:a.orders.selectedProc.proType,name:a.orders.selectedProc.name,costo:a.orders.selectedProc.costo?a.orders.selectedProc.costo:0,pago:a.orders.selectedProc.pago?a.orders.selectedProc.pago:0}),a.getTotal()}else alertify.error(a.orders.rSereal+" ya existe")})},this.setPatientDetail=function(b){var c=b;a.orders.newPatient={},a.orders.selectedPatient=a.orders.getPatientById(c)},z.setNewPatient=function(){a.orders.selectedPatient={},a.orders.selectedOrder.patient=""},this.setClinicaDetail=function(b){var c=b;a.orders.selectedClinica=a.orders.getClinicaById(c)},a.setProcsDetail=function(b){a.orders.setProcDetail(b)},a.getTotal=function(){a.orders.selectedOrder.total=0,a.orders.selectedOrder.pago=0,a.orders.selectedOrder.debe=0;for(var b=0;b<a.orders.orderDetail.length;b++)a.orderd=a.orders.orderDetail[b],a.orders.selectedOrder.total+=Number(a.orderd.costo?a.orderd.costo:0),a.orders.selectedOrder.pago+=Number(a.orderd.pago?a.orderd.pago:0);a.orders.selectedOrder.debe=Number(a.orders.selectedOrder.pago>a.orders.selectedOrder.total?0:a.orders.selectedOrder.total-a.orders.selectedOrder.pago)},this.deleteProcs=function(b){a.orders.orderDetail.splice(b,1),a.getTotal()},this.modelCreate=function(a){var b=m.open({templateUrl:"clientes/views/create-clientes.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){n.info("Modal dismissed at: "+new Date)})},a.modelRemove=function(a,b){var c=m.open({templateUrl:"orders/views/orders-cancel.template.html",controller:function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}},size:a});c.result.then(function(a){},function(){n.info("Modal dismissed at: "+new Date)})},this.create=function(b){a.orders.newPatient.patientFirstName?a.orders.createNewPatient().then(function(){a.orders.create(b).then(function(b){a.orders.clearForm(),j.sendMsg("newOrderPost",{id:"nada"})})}):a.orders.create(b).then(function(b){a.orders.clearForm(),j.sendMsg("newOrderPost",{id:"nada"})})}}]),ordersModule.directive("autoComplete",function(){return{}}),ordersModule.directive("orderList",["Orders","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"orders/views/orders-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(a,b){})}}}]),ordersModule.directive("resultList",["Orders","Notify","Result",function(a,b,c){return{restrict:"E",transclude:!0,templateUrl:"results/views/result-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(a,b){})}}}]),ordersModule.service("OrderServices",["$q","$timeout","$http","Procs","Orders","Result","Patients","Cliente",function(a,b,c,d,e,f,g,h){var i={bInfo:null,blInfo:null,pInfo:null,bflag:!1,blFlag:!1,clinic:null,noClinica:!1,newPatient:{},isDeleting:!1,createMode:!0,createdD:null,createdDate:"",createdDateDoctor:null,updatedProcs:null,selectedProc:null,isSaving:!1,seguroList:[],clinicaList:[],selectedOrder:null,rSereal:null,selectedDoctor:null,selectedClinica:null,selectedPatient:null,orderResult:null,rpaciente:{},bCunter:0,blCunter:0,pCunter:0,procList:[],reportSave:[],doctorList:[],patientList:[],listadoClinica:[],orderDetail:[],clearForm:function(){i.selectedPatient={},i.newPatient={},i.updatedProcs=null,i.rSereal=null,i.isSaving=!1,i.createMode=!0,i.noClinica=!1,i.selectedOrder={},i.selectedDoctor={},i.selectedPatient={},i.clinicaList=[],i.orderDetail=[],i.selectedOrder.total=0,i.selectedOrder.pago=0,i.selectedOrder.debe=0,i.createdDate=moment().format(),i.createdDateDoctor=moment().format()},createNewPatient:function(){var b=a.defer(),c={tipo:i.newPatient.PatientCI?"Cedula":"",value:i.newPatient.PatientCI?i.newPatient.PatientCI.tipovalue:""};i.newPatient.PatientCI=c;var d=new g(i.newPatient);return d.$save(function(a){i.selectedOrder.patient=a._id,i.getPatientList().then(function(){i.selectedPatient=i.getPatientById(i.selectedOrder.patient),b.resolve(a)})},function(a){b.reject()}),b.promise},saveReport:function(b){var d=a.defer();b.$save(function(a){var b=0;"B"===a.tipomuestra?b=i.bCunter:"BL"===a.tipomuestra?(b=i.blCunter,i.blFlag=!0):b=i.pCunter;var e={year:i.bInfo[0].year,month:i.bInfo[0].month,proType:a.tipomuestra,newCount:b};c.post("/api/count",{info:e}).success(function(a){i.getBL(),i.getB(),i.getP()}).error(function(a){}),d.resolve()},function(a){d.reject(a)})},create:function(b){i.isSaving=!0;var c=a.defer();if(i.createMode){var d=new e({proclist:b,nota:i.selectedOrder.nota,total:i.selectedOrder.total,patientName:i.selectedPatient.patientFirstName+" "+i.selectedPatient.patientLastName,patientId:i.selectedPatient.patientId,clienteName:i.selectedClinica.name,doctorName:i.selectedDoctor.firstName+" "+i.selectedDoctor.lastName,patientEdad:i.selectedPatient?i.selectedPatient.patientEdad:null,cliente:i.selectedOrder.clinica,doctor:i.selectedOrder.doctor,patients:i.selectedOrder.patient,created:i.getDate(new Date(i.createdDate))});d.$save(function(a){i.orderResult=a;for(var b=0;b<i.orderResult.proclist.length;b++){var d=new f({rSereal:i.orderResult.proclist[b].id,tipomuestra:i.orderResult.proclist[b].procType,tipomuestraDesc:i.orderResult.proclist[b].name,reportStatus:"Pendiente",orders:i.orderResult._id,costo:i.orderResult.proclist[b].costo,pago:i.orderResult.proclist[b].pago,debe:i.orderResult.proclist[b].pago>i.orderResult.proclist[b].costo?0:i.orderResult.proclist[b].costo-i.orderResult.proclist[b].pago,patientReport:i.orderResult.patients,seguroId:i.selectedPatient.locations?i.selectedPatient.locations._id:null,doctor:i.orderResult.doctor,clinica:i.orderResult.cliente,seguroDesc:i.selectedPatient.locations?i.selectedPatient.locations.name:"",created:i.getDate(new Date(i.createdDate)),createdDateDoctor:i.getDate(new Date(i.createdDateDoctor)),procs:i.selectedProc._id});i.saveReport(d)}return c.resolve(),c.promise},function(a){})}else{var g=new f({_id:i.updatedProcs._id,costo:i.selectedOrder.total,pago:i.selectedOrder.pago,debe:i.selectedOrder.debe,patientReport:i.selectedPatient._id,seguroId:i.selectedPatient.locations?i.selectedPatient.locations._id:null,doctor:i.selectedDoctor._id,clinica:i.selectedOrder.clinica,nota:i.selectedOrder.nota,reportStatus:i.updatedProcs.reportStatus,seguroDesc:i.selectedPatient.locations?i.selectedPatient.locations.name:"",created:moment(i.createdDate).format("YYYY-MM-DD"),createdDateDoctor:moment(i.createdDateDoctor).format("YYYY-MM-DD")});g.$update(function(){i.isSaving=!1,i.clearForm(),c.resolve(),alertify.success("Acción realizada exitosamente!!")},function(){i.isSaving=!1,alertify.error("Se ha producido un error"),c.reject(errorResponse)})}return c.promise},getB:function(){c.post("/api/getMaxB",{type:"B"}).success(function(a){i.bInfo=a}).error(function(a){})},getBL:function(){c.post("/api/getMaxB",{type:"BL"}).success(function(a){i.blInfo=a}).error(function(a){})},getP:function(){c.post("/api/getMaxB",{type:"P"}).success(function(a){i.pInfo=a}).error(function(a){})},getprocList:function(){var b=a.defer();return c.post("procs/getList").success(function(a){a&&(i.procList=[],angular.forEach(a,function(a){i.procList.push(a)}),b.resolve())}).error(function(a){console.log(a)}),b.promise},getDoctorList:function(){var b=a.defer();return c.post("doctor/getList").success(function(a){a&&(i.doctorList=[],angular.forEach(a,function(a){i.doctorList.push(a)}),b.resolve())}).error(function(a){}),b.promise},getPatientList:function(){var b=a.defer();return c.post("patient/getList").success(function(a){a&&(i.patientList=[],angular.forEach(a,function(a){i.patientList.push(a)}),b.resolve())}).error(function(a){}),b.promise},getClinicaList:function(){c.post("cliente/getList").success(function(a){a&&(i.listadoClinica=[],angular.forEach(a,function(a){i.listadoClinica.push(a)}))}).error(function(a){})},setProcDetail:function(a){i.selectedProc=i.getProcById(a),i.selectedProc&&c.post("/api/resultMax",{resultType:i.selectedProc.proType}).then(function(a){i.rSereal=a.data[0].rSereal})},getSeguroList:function(){c.post("locations/getList").success(function(a){a&&(i.seguroList=[],angular.forEach(a,function(a){i.seguroList.push(a)}))}).error(function(a){})},getProcById:function(a){for(var b=0;b<i.procList.length;b++){var c=i.procList[b];if(c._id===a)return c}},getDoctorById:function(a){for(var b=0;b<i.doctorList.length;b++){var c=i.doctorList[b];if(c._id===a)return c}},getClinicaById:function(a){for(var b=0;b<i.listadoClinica.length;b++){var c=i.listadoClinica[b];if(c._id===a)return c}},getPatientById:function(a){for(var b=0;b<i.patientList.length;b++){var c=i.patientList[b];if(c._id===a)return c}},setDoctorDetail:function(a){a&&i.getDoctorList().then(function(){i.selectedOrder.doctor=a,i.selectedDoctor=i.getDoctorById(a),i.selectedDoctor&&(i.selectedDoctor.clinicaList.length>0?(i.noClinica=!1,i.clinicaList=i.selectedDoctor.clinicaList,i.updatedProcs?i.selectedOrder.clinica=i.updatedProcs.clinica:(i.selectedOrder.clinica=i.clinicaList?i.clinicaList[0].id:"",i.selectedClinica=i.getClinicaById(i.selectedOrder.clinica))):(i.noClinica=!0,i.selectedOrder.clinica="",i.selectedClinica="",i.clinicaList=[]))})},getDate:function(a){return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)},getTimeZone:function(a){return new Date(a.getTime()+6e4*a.getTimezoneOffset())}};return i.getSeguroList(),i.selectedOrder={},i.getB(),i.getP(),i.getBL(),i}]),angular.module("orders").factory("Orders",["$resource",function(a){return a("api/orders/:ordersId",{ordersId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a,b,c){var d={};return d.msg="",d.sendbroadCast=function(a){this.msg=a,this.broadCast(a),console.log(this.mgs)},d.broadCast=function(b){a.$broadcast("noError",b)},d.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},d.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},d}]).factory("CierreControl",["$q","$http",function(a,b){var c=this;return c.getActiveCurrentMonth=function(c){var d=a.defer();return b.post("/api/getMaxB",{type:c}).success(function(a){console.log(a),d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},c}]),angular.module("locations",[]),angular.module("locations").config(["$stateProvider",function(a){a.state("listLocations",{url:"/locations",templateUrl:"locations/views/list-locations.client.view.html"})}]);var locationModule=angular.module("locations");locationModule.controller("locationController",["$scope","$http","$location","Authentication","Pais","Ciudad","Sector","Locations","Notify","ngTableParams","$modal","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){this.authentication=d;var m={page:1,count:15,filter:{name:name}},n={total:0,counts:[15,20,25],getData:function(b,c){h.get(c.url(),function(d){c.total(d.total),b.resolve(d.results),a.total=d.total})}};a.tableParams=new j(m,n),this.modelCreate=function(a){var b=k.open({templateUrl:"locations/views/create-location.client.view.html",controller:"modalResutl",size:a});b.result.then(function(a){},function(){l.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(b,c){var d=k.open({templateUrl:"locations/views/edit-location.client.view.html",controller:["$scope","$modalInstance","location",function(a,b,d){a.location=d,a.location.rpais=c.pais,a.location.rciudad=c.ciudad,a.location.rsector=c.sector,a.ok=function(){b.close(a.location)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{location:function(){return c}}});d.result.then(function(b){a.selected=b},function(){l.info("Modal dismissed at: "+new Date)})},a.doSearch=function(){a.tableParams.reload()},i.getMsg("updateLoc",function(b,c){a.doSearch(),alertify.success("Acción realizada exitosamente!! !!")}),this.modelRemove=function(b,c){a.location=c;var d=k.open({templateUrl:"locations/views/delete-location.client.view.html",controller:["$scope","$modalInstance","location",function(a,b,c){a.location=c,a.ok=function(){b.close(a.location)},a.cancel=function(){b.dismiss("cancel")}}],size:b,resolve:{location:function(){return c}}});d.result.then(function(b){a.selected=b},function(){l.info("Modal dismissed at: "+new Date)})},a.remove=function(a){if(a){a.$remove();for(var b in this.location)this.location[b]===a&&this.location.splice(b,1)}else this.location.$remove(function(){})}}]),locationModule.controller("locationDeleteController",["$scope","Authentication","Locations","Notify",function(a,b,c,d){this["delete"]=function(b){var e=new c({_id:a.location._id});e.$remove(function(){d.sendMsg("updateLoc",{id:"nada"})},function(b){a.error=b.data.message})}}]),locationModule.controller("locationUpdateController",["$scope","Authentication","Locations","Notify","Pais","Ciudad","Sector","$mdToast","$animate",function(a,b,c,d,e,f,g,h,i){this.pais=e.query(),this.ciudad=f.query(),this.sector=g.query(),this.filterByPais=function(){this.sector={}},this.filterByCiudad=function(){this.sector=g.query()},this.update=function(b){var e=new c({_id:b._id,name:b.name,tipo:b.tipo,locationRNC:b.locationRNC,locationTelefono:b.locationTelefono,pais:a.location.rpais,ciudad:a.location.rciudad,sector:a.location.rsector,locationDireccion:b.locationDireccion});e.$update(function(){d.sendMsg("updateLoc",{id:"update"})},function(b){a.error=b.data.message})}}]),locationModule.controller("modalResutl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),locationModule.controller("locationCreateController",["$scope","Locations","Notify","Pais","Ciudad","Sector",function(a,b,c,d,e,f){this.pais=d.query(),this.filterByCity=function(){this.ciudad=e.query(),this.sector=""},this.filterSector=function(){this.sector=f.query()},this.create=function(){var d=new b({name:this.name,locationRNC:this.locationRNC,locationTelefono:this.locationTelefono,pais:this.locationPais,ciudad:this.locationCiudad,sector:this.locationSector,locationDireccion:this.locationDireccion});d.$save(function(a){c.sendMsg("updateLoc",{id:"nada"})},function(b){a.error=b.data.message})}}]),locationModule.directive("locationList",["Locations","Notify",function(a,b){return{restrict:"E",transclude:!0,templateUrl:"locations/views/locations-list.template.html",link:function(a,c,d){b.getMsg("newPis",function(b,c){a.locationCtrl.doSearch()})}}}]),angular.module("locations").factory("Locations",["$resource",function(a){return a("locations/:locationId",{locationId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function(a){var b={};return b.msg="",b.sendbroadCast=function(a){this.msg=a,this.broadCast(a)},b.broadCast=function(b){a.$broadcast("noError",b)},b.sendMsg=function(b,c){c=c||{},a.$emit(b,c)},b.getMsg=function(b,c,d){var e=a.$on(b,c);d&&d.$on("destroy",e)},b}]).factory("LocationAction",["$http","$q",function(a,b){var c={};return c.getlocationList=function(){var c=b.defer();return a.post("locations/getList").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},c}]);